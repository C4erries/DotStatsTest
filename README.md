# DotStatsTest

**Краткое описание**
DotStatsTest — это альфа-версия аналитической платформы для Dota 2, которая предоставляет удобный и подробный анализ матчей и статистики игроков. Проект реализован на Go и использует OpenDota API для сбора и обработки данных.

---

## Содержание

* [Цели и задачи](#цели-и-задачи)
* [Ключевые возможности](#ключевые-возможности)
* [Архитектура проекта](#архитектура-проекта)
* [Установка и запуск](#установка-и-запуск)
* [Конфигурация](#конфигурация)
* [Использование API](#использование-api)
* [Структура репозитория](#структура-репозитория)
* [Миграции базы данных](#миграции-базы-данных)
* [Команды Makefile](#команды-makefile)
* [Команда разработчиков](#команда-разработчиков)
* [Дальнейшие планы](#дальнейшие-планы)

---

## Цели и задачи

* Разработать бэкенд для сбора, обработки и предоставления статистики по Dota 2 из OpenDota API.
* Обеспечить API для фронтенда, способного визуализировать данные о матчах и игроках.
* Настроить механизм миграций баз данных и управляемых конфигураций.
* Подключить систему CI/CD для автоматизации сборки и тестирования.

---

## Ключевые возможности

* **Интеграция с OpenDota API**: асинхронный сбор статистики матчей и игроков.
* **RESTful API**: эндпоинты для получения информации о матчах, игроках, рейтингах.
* **Миграции БД**: управление схемой и изменениями через встроенный механизм.
* **Конфигурируемость**: поддержка нескольких сред (dev, staging, prod) через файлы конфигурации.
* **Makefile**: автоматизация задач сборки, миграций и тестирования.

---

## Архитектура проекта

```
DotStatsTest/
├── cmd/apiserver/         # main.go: запуск HTTP-сервера
├── configs/               # Конфигурационные файлы YAML для разных сред
├── internal/app/          # Бизнес-логика, сервисы и обработчики
├── internal/jsons/        # Примеры JSON-ответов и схемы
├── internal/migrations/   # SQL-скрипты для миграций базы данных
├── Makefile               # Команды для сборки, миграций и тестов
├── go.mod                 # Модули и зависимости Go
├── go.sum
└── README.md
```

---

## Установка и запуск

1. Клонировать репозиторий:

   ```bash
   git clone https://github.com/C4erries/DotStatsTest.git
   cd DotStatsTest
   ```
2. Установить зависимости и собрать проект:

   ```bash
   go mod download
   make build
   ```
3. Настроить конфигурацию:

   ```bash
   cp configs/dev.yaml configs/local.yaml
   # Отредактировать параметры: OpenDotaAPI URL, порты, строки подключения к БД
   ```
4. Выполнить миграции БД:

   ```bash
   make migrate-up
   ```
5. Запустить сервер:

   ```bash
   make run
   ```
6. Открыть API-перечень в браузере:

   ```
   http://localhost:8080/api/docs
   ```

---

## Конфигурация

Файл `configs/local.yaml` содержит:

```yaml
server:
  port: 8080

database:
  driver: postgres
  dsn: host=localhost user=postgres password=secret dbname=dotstats sslmode=disable

opendota:
  api_url: https://api.opendota.com/api
  api_key: YOUR_API_KEY_HERE
```

---

## Использование API

Пример эндпоинтов:

* `GET /api/matches/{match_id}` — получить детали матча.
* `GET /api/players/{account_id}` — получить информацию об игроке.
* `GET /api/players/{account_id}/matches` — список последних матчей.

Ответы возвращаются в формате JSON.

---

## Структура репозитория

Уже описана в разделе "Архитектура проекта", отражает разделение на сервисную логику, конфигурацию и миграции.

---

## Миграции базы данных

В каталоге `internal/migrations` хранятся SQL-файлы:

* `0001_init.up.sql` — начальная схема таблиц.
* `0001_init.down.sql` — откат схемы.

Управление миграциями через `make migrate-up` / `make migrate-down`.

---

## Команды Makefile

* `make build` — сборка исполняемого файла.
* `make run` — запуск сервера.
* `make test` — запуск всех тестов.
* `make migrate-up` — применение всех миграций.
* `make migrate-down` — откат всех миграций.

---

## Команда разработчиков

* **Tablesaw** — Бэкенд и администрирование БД.
* **C4erries** — Фронтенд, бэкенд.

---

## Дальнейшие планы

* Реализовать кеширование часто запрашиваемых данных.
* Добавить систему аутентификации и авторизации пользователей.
* Подключить сбор метрик и мониторинг (Prometheus/Grafana).
* Развернуть на Kubernetes с использованием Helm-чарта.

---

Powered by [OpendotaApi](https://docs.opendota.com)
